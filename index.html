<!DOCTYPE html>
<html lang="es" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MUVN - Acceso Seguro</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        muvnBlue: '#0DA4BF',
                        muvnDark: '#0E0E0E', 
                    }
                }
            }
        }
    </script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>

    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .fade-in { animation: fadeIn 0.4s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        /* Inputs legibles: Fondo blanco, texto negro */
        .dark-input {
            @apply w-full p-3 bg-gray-100 border border-gray-300 rounded-lg text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-[#0DA4BF] focus:border-transparent outline-none transition font-medium;
        }
    </style>
</head>
<body class="bg-slate-900 text-slate-100 min-h-screen">

    <div id="root"></div>

    <script type="text/babel">
        // ---------------------------------------------------------
        // 1. CONFIGURACI√ìN DE FIREBASE
        // ---------------------------------------------------------
        const firebaseConfig = {
            apiKey: "AIzaSyDmf2tlJYR7cP_vxv66tVozQDBFehURGXM",
            authDomain: "data-d064b.firebaseapp.com",
            projectId: "data-d064b",
            storageBucket: "data-d064b.firebasestorage.app",
            messagingSenderId: "15120958868",
            appId: "1:15120958868:web:ec1d059d08f631bb81fb81"
        };

        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const db = firebase.firestore();
        db.settings({ experimentalForceLongPolling: true }); 
        firebase.firestore.setLogLevel('silent');

        // ---------------------------------------------------------
        // 2. DATOS (Cuidadores vinculados a Pacientes y TURNOS)
        // ---------------------------------------------------------
        
        // AQUI ES DONDE SE CONFIGURA EL TURNO (assignedShift: 'dia' o 'noche')
        const CAREGIVERS = [
            // Supervisor (Sin restricci√≥n de turno)
            { name: "Mario Ulises Vallejo Navarrete", pin: "0000", isSupervisor: true }, 
            
            // Cuidadores con Turno Asignado
            { name: "Ana Mart√≠nez", pin: "1111", assignedPatientId: "p1", assignedShift: "noche" },
            { name: "Carlos Vel√°zquez", pin: "2222", assignedPatientId: "p2", assignedShift: "noche" }, // Ejemplo Turno Noche
            { name: "Beatriz Sol√≠s", pin: "3333", assignedPatientId: "p3", assignedShift: "dia" },
            { name: "David L√≥pez", pin: "4444", assignedPatientId: "p4", assignedShift: "dia" },
            { name: "Elena Ram√≠rez", pin: "5555", assignedPatientId: "p5", assignedShift: "noche" }, // Ejemplo Turno Noche
            { name: "Fernando Ruiz", pin: "9999", assignedPatientId: "p6", assignedShift: "dia" },
            { name: "Gabriela Torres", pin: "1010", assignedPatientId: "p7", assignedShift: "dia" },
            { name: "H√©ctor Jim√©nez", pin: "2020", assignedPatientId: "p8", assignedShift: "noche" }, // Ejemplo Turno Noche
            { name: "Isabel Castro", pin: "3030", assignedPatientId: "p9", assignedShift: "dia" },
            { name: "Jorge Medina", pin: "4040", assignedPatientId: "p10", assignedShift: "dia" },
            { name: "Karla Orozco", pin: "5050", assignedPatientId: "p11", assignedShift: "noche" }, // Ejemplo Turno Noche
            { name: "Luis Navarro", pin: "6060", assignedPatientId: "p12", assignedShift: "dia" },
            
            // Apoyo / Cubreturnos (Se les asigna turno espec√≠fico seg√∫n necesidad)
            { name: "M√≥nica Pineda", pin: "7070", assignedPatientId: "p1", assignedShift: "noche" }, 
            { name: "N√©stor Vargas", pin: "8080", assignedPatientId: "p2", assignedShift: "dia" }, 
            { name: "Olivia Rivas", pin: "9090", assignedPatientId: "p3", assignedShift: "noche" },  
            { name: "Pablo Est√©vez", pin: "1234", assignedPatientId: "p4", assignedShift: "dia" }   
        ];

        const PATIENTS = [
            {
                id: 'p1', 
                name: "Don Roberto", 
                condition: "Diabetes T2 / Hipertensi√≥n",
                info: { address: "Calle Roble #123", emergency: "Hijo: Luis (445-555-9876)", age: "78", weight: "82kg", bloodType: "O+", allergies: "Penicilina", doctor: "Dr. Gtz", diet: "Diab√©tica" },
                tasks: {
                    dia: [ 
                        { id: 'p1_d1', text: "07:00 - Toma de Glucosa en ayunas", type: "vital" },
                        { id: 'p1_d2', text: "07:30 - Insulina NPH / Medicamentos AM", type: "med" },
                        { id: 'p1_d3', text: "08:30 - Desayuno completo", type: "food" },
                        { id: 'p1_d4', text: "10:00 - Ba√±o de regadera y humectaci√≥n", type: "hygiene" },
                        { id: 'p1_d5', text: "12:00 - Colaci√≥n matutina y Toma de PA", type: "food" },
                        { id: 'p1_d6', text: "14:00 - Comida principal", type: "food" },
                        { id: 'p1_d7', text: "16:00 - Caminata 20 min (si el clima permite)", type: "physio" },
                        { id: 'p1_d8', text: "18:00 - Merienda ligera", type: "food" }
                    ],
                    noche: [ 
                        { id: 'p1_n1', text: "19:00 - Cena ligera", type: "food" },
                        { id: 'p1_n2', text: "20:00 - Glucosa post-pandrial y Signos", type: "vital" },
                        { id: 'p1_n3', text: "21:00 - Insulina Glargina y Meds Nocturnos", type: "med" },
                        { id: 'p1_n4', text: "22:00 - Aseo dental y preparaci√≥n cama", type: "hygiene" },
                        { id: 'p1_n5', text: "00:00 - Ronda de monitoreo sue√±o", type: "check" },
                        { id: 'p1_n6', text: "03:00 - Ronda de monitoreo / Ida al ba√±o", type: "check" },
                        { id: 'p1_n7', text: "06:00 - Preparar insumos glucosa AM", type: "check" }
                    ]
                }
            },
            {
                id: 'p2', 
                name: "Sra. Elena", 
                condition: "Post-Op Cadera / EPOC",
                info: { address: "Av. Morelos #45", emergency: "Hija: Clara (445-555-1122)", age: "84", weight: "60kg", bloodType: "A-", allergies: "Ninguna", doctor: "Dra. Salas", diet: "Alta fibra" },
                tasks: {
                    dia: [
                        { id: 'p2_d1', text: "08:00 - Nebulizaci√≥n Matutina y Signos", type: "med" },
                        { id: 'p2_d2', text: "09:00 - Desayuno asistido", type: "food" },
                        { id: 'p2_d3', text: "10:00 - Ba√±o de esponja (cuidar ap√≥sito)", type: "hygiene" },
                        { id: 'p2_d4', text: "11:00 - Curaci√≥n herida quir√∫rgica", type: "cure" },
                        { id: 'p2_d5', text: "13:00 - Ejercicios respiratorios / Espir√≥metro", type: "physio" },
                        { id: 'p2_d6', text: "14:30 - Comida y Medicamento dolor", type: "food" },
                        { id: 'p2_d7', text: "17:00 - Movilizaci√≥n a reposet", type: "physio" },
                        { id: 'p2_d8', text: "18:30 - Nebulizaci√≥n Vespertina", type: "med" }
                    ],
                    noche: [
                        { id: 'p2_n1', text: "20:00 - Cena y Ox√≠geno (2L/min) continuo", type: "med" },
                        { id: 'p2_n2', text: "22:00 - Aseo, Cambio Pa√±al, Medias compresi√≥n", type: "hygiene" },
                        { id: 'p2_n3', text: "00:00 - Cambio de posici√≥n (Dec√∫bito Lateral)", type: "physio" },
                        { id: 'p2_n4', text: "02:00 - Revisi√≥n Saturaci√≥n O2 y Pa√±al", type: "vital" },
                        { id: 'p2_n5', text: "04:00 - Cambio de posici√≥n", type: "physio" },
                        { id: 'p2_n6', text: "06:00 - Retirar medias y lubricar piel", type: "cure" }
                    ]
                }
            },
            {
                id: 'p3',
                name: "Don Jorge",
                condition: "Parkinson Avanzado",
                info: { address: "Calle Madero #88", emergency: "Esposa: Rosa (445-123-4567)", age: "75", weight: "70kg", bloodType: "B+", allergies: "Sulfa", doctor: "Dr. Neuro", diet: "Papilla" },
                tasks: {
                    dia: [
                        { id: 'p3_d1', text: "07:00 - Levodopa/Carbidopa (ESTRICTO)", type: "med" },
                        { id: 'p3_d2', text: "08:00 - Desayuno asistido (paciencia)", type: "food" },
                        { id: 'p3_d3', text: "09:30 - Ba√±o silla y afeitado", type: "hygiene" },
                        { id: 'p3_d4', text: "11:00 - Levodopa/Carbidopa (ESTRICTO)", type: "med" },
                        { id: 'p3_d5', text: "12:00 - Terapia de marcha / Movilidad", type: "physio" },
                        { id: 'p3_d6', text: "14:00 - Comida (textura papilla) e Hidrataci√≥n", type: "food" },
                        { id: 'p3_d7', text: "15:00 - Levodopa/Carbidopa (ESTRICTO)", type: "med" },
                        { id: 'p3_d8', text: "18:00 - Aseo perineal y cambio ropa", type: "hygiene" }
                    ],
                    noche: [
                        { id: 'p3_n1', text: "19:00 - Levodopa/Carbidopa (ESTRICTO)", type: "med" },
                        { id: 'p3_n2', text: "19:30 - Cena ligera asistida", type: "food" },
                        { id: 'p3_n3', text: "21:00 - Preparaci√≥n dormir / Aseo bucal", type: "hygiene" },
                        { id: 'p3_n4', text: "23:00 - Revisi√≥n rigidez y postura", type: "check" },
                        { id: 'p3_n5', text: "02:00 - Asistencia orinal / Pa√±al", type: "hygiene" },
                        { id: 'p3_n6', text: "05:00 - Cambio de postura", type: "physio" },
                        { id: 'p3_n7', text: "07:00 - Entrega de turno y Meds AM", type: "check" }
                    ]
                }
            },
            {
                id: 'p4',
                name: "Sra. Margarita",
                condition: "Alzheimer (Fase Media)",
                info: { address: "Portal Zauco #12", emergency: "Hijo: Pedro (445-987-6543)", age: "81", weight: "55kg", bloodType: "O-", allergies: "Polen", doctor: "Dr. Psique", diet: "Normal" },
                tasks: {
                    dia: [
                        { id: 'p4_d1', text: "08:00 - Despertar suave y Memantina", type: "med" },
                        { id: 'p4_d2', text: "09:00 - Desayuno y Socializaci√≥n", type: "food" },
                        { id: 'p4_d3', text: "10:30 - Aseo personal supervisado", type: "hygiene" },
                        { id: 'p4_d4', text: "12:00 - Actividad cognitiva (m√∫sica/fotos)", type: "physio" },
                        { id: 'p4_d5', text: "14:00 - Comida principal", type: "food" },
                        { id: 'p4_d6', text: "16:00 - Siesta corta (m√°x 30 min)", type: "check" },
                        { id: 'p4_d7', text: "17:00 - Hidrataci√≥n y caminata patio", type: "physio" },
                        { id: 'p4_d8', text: "18:30 - Inicio protocolo calma (bajar luces)", type: "check" }
                    ],
                    noche: [
                        { id: 'p4_n1', text: "19:30 - Cena y Quetiapina 25mg", type: "med" },
                        { id: 'p4_n2', text: "20:30 - Acompa√±amiento al ba√±o y pijama", type: "hygiene" },
                        { id: 'p4_n3', text: "22:00 - Asegurar puertas y ventanas", type: "check" },
                        { id: 'p4_n4', text: "00:00 - Monitoreo visual (sin despertar)", type: "check" },
                        { id: 'p4_n5', text: "03:00 - Asistencia ba√±o si despierta", type: "hygiene" },
                        { id: 'p4_n6', text: "06:00 - Monitoreo final", type: "check" }
                    ]
                }
            },
            {
                id: 'p5',
                name: "Don Felipe",
                condition: "Secuelas EVC / Hemiplejia",
                info: { address: "Calle 16 de Septiembre", emergency: "Nieta: Ana (445-111-2222)", age: "69", weight: "75kg", bloodType: "A+", allergies: "Aspirina", doctor: "Dr. Vascular", diet: "Blanda" },
                tasks: {
                    dia: [
                        { id: 'p5_d1', text: "08:00 - Signos Vitales y Movilizaci√≥n cama", type: "physio" },
                        { id: 'p5_d2', text: "09:00 - Desayuno y Medicamentos (Antihipertensivo)", type: "med" },
                        { id: 'p5_d3', text: "10:30 - Ba√±o de regadera (silla ruedas)", type: "hygiene" },
                        { id: 'p5_d4', text: "12:00 - Ejercicios pasivos lado afectado", type: "physio" },
                        { id: 'p5_d5', text: "14:00 - Comida y Aseo bucal posterior", type: "food" },
                        { id: 'p5_d6', text: "16:00 - Cambio pa√±al y revisi√≥n piel sacra", type: "hygiene" },
                        { id: 'p5_d7', text: "18:00 - Sentar en reposet 1 hora", type: "physio" }
                    ],
                    noche: [
                        { id: 'p5_n1', text: "20:00 - Cena y Cambio de pa√±al", type: "hygiene" },
                        { id: 'p5_n2', text: "22:00 - Hidrataci√≥n piel y acomodo almohadas", type: "cure" },
                        { id: 'p5_n3', text: "00:00 - CAMBIO POSTURA (Derecho)", type: "physio" },
                        { id: 'p5_n4', text: "03:00 - CAMBIO POSTURA (Izquierdo) y Pa√±al", type: "physio" },
                        { id: 'p5_n5', text: "06:00 - CAMBIO POSTURA (Supino) y S√°banas", type: "physio" }
                    ]
                }
            },
            {
                id: 'p6',
                name: "Sra. Carmen",
                condition: "Artritis Reumatoide Severa",
                info: { address: "Col. La Joya #55", emergency: "Hija: Sofia (445-333-4444)", age: "72", weight: "65kg", bloodType: "B-", allergies: "Ninguna", doctor: "Dr. Reuma", diet: "Antiinflamatoria" },
                tasks: {
                    dia: [
                        { id: 'p6_d1', text: "08:00 - Prednisona y Analg√©sico (antes de mover)", type: "med" },
                        { id: 'p6_d2', text: "09:00 - Desayuno y Compresas tibias manos", type: "cure" },
                        { id: 'p6_d3', text: "11:00 - Ayuda ba√±o agua caliente (rigidez)", type: "hygiene" },
                        { id: 'p6_d4', text: "13:00 - Movilizaci√≥n suave articulaciones", type: "physio" },
                        { id: 'p6_d5', text: "14:30 - Comida (dieta mediterr√°nea)", type: "food" },
                        { id: 'p6_d6', text: "17:00 - Terapia ocupacional ligera", type: "physio" },
                        { id: 'p6_d7', text: "19:00 - Preparar medicaci√≥n nocturna", type: "med" }
                    ],
                    noche: [
                        { id: 'p6_n1', text: "20:00 - Cena y Tramadol gotas", type: "med" },
                        { id: 'p6_n2', text: "21:30 - Masaje suave con pomada y pijama", type: "physio" },
                        { id: 'p6_n3', text: "23:00 - Acomodo almohadas entre piernas", type: "check" },
                        { id: 'p6_n4', text: "02:00 - Asistencia al ba√±o (riesgo ca√≠das)", type: "hygiene" },
                        { id: 'p6_n5', text: "05:00 - Revisi√≥n confort / Cobijas", type: "check" }
                    ]
                }
            },
            {
                id: 'p7',
                name: "Don Luis",
                condition: "Insuficiencia Renal (Di√°lisis)",
                info: { address: "Calle P√≠pila #8", emergency: "Hermano: Juan (445-555-7777)", age: "65", weight: "68kg", bloodType: "AB+", allergies: "Yodo", doctor: "Dr. Nefro", diet: "Renal" },
                tasks: {
                    dia: [
                        { id: 'p7_d1', text: "07:00 - PESO MATUTINO y Signos Vitales", type: "vital" },
                        { id: 'p7_d2', text: "08:00 - Medicamentos quelantes con Desayuno", type: "med" },
                        { id: 'p7_d3', text: "09:30 - PREPARACI√ìN DI√ÅLISIS (Asepsia)", type: "cure" },
                        { id: 'p7_d4', text: "10:00 - CONEXI√ìN DI√ÅLISIS (Bolsa 1)", type: "cure" },
                        { id: 'p7_d5', text: "12:00 - Drenaje y control de l√≠quido (Balance)", type: "check" },
                        { id: 'p7_d6', text: "14:00 - Comida estricta (Baja sal/potasio)", type: "food" },
                        { id: 'p7_d7', text: "16:00 - CONEXI√ìN DI√ÅLISIS (Bolsa 2)", type: "cure" },
                        { id: 'p7_d8', text: "18:00 - Drenaje y Balance h√≠drico", type: "check" }
                    ],
                    noche: [
                        { id: 'p7_n1', text: "20:00 - Cena y Medicamentos PA", type: "med" },
                        { id: 'p7_n2', text: "22:00 - CONEXI√ìN NOCTURNA (M√°quina o Manual)", type: "cure" },
                        { id: 'p7_n3', text: "23:00 - Verificar cat√©ter y flujo", type: "check" },
                        { id: 'p7_n4', text: "02:00 - Monitoreo alarmas m√°quina / Drenaje", type: "check" },
                        { id: 'p7_n5', text: "06:00 - DESCONEXI√ìN y Cierre Balance 24h", type: "cure" }
                    ]
                }
            },
            {
                id: 'p8',
                name: "Sra. Rosa",
                condition: "Insuficiencia Card√≠aca",
                info: { address: "Av. Las Flores #100", emergency: "Vecina: Lupe (445-888-9999)", age: "79", weight: "58kg", bloodType: "O+", allergies: "L√°tex", doctor: "Dr. Cardio", diet: "Sin sal" },
                tasks: {
                    dia: [
                        { id: 'p8_d1', text: "08:00 - Peso diario y Furosemida", type: "med" },
                        { id: 'p8_d2', text: "09:00 - Desayuno sin sal y l√≠quidos medidos", type: "food" },
                        { id: 'p8_d3', text: "11:00 - Revisi√≥n edema (hinchaz√≥n) pies", type: "check" },
                        { id: 'p8_d4', text: "13:00 - Descanso piernas elevadas", type: "physio" },
                        { id: 'p8_d5', text: "14:30 - Comida y Meds coraz√≥n", type: "food" },
                        { id: 'p8_d6', text: "17:00 - Toma Presi√≥n Arterial y FC", type: "vital" },
                        { id: 'p8_d7', text: "18:00 - Caminata leve interior", type: "physio" }
                    ],
                    noche: [
                        { id: 'p8_n1', text: "19:30 - Cena muy ligera (evitar reflujo)", type: "food" },
                        { id: 'p8_n2', text: "21:00 - Acomodo almohadas (Posici√≥n Fowler)", type: "physio" },
                        { id: 'p8_n3', text: "22:00 - Revisi√≥n dificultad respiratoria", type: "vital" },
                        { id: 'p8_n4', text: "00:00 - Asistencia orinal (diur√©tico)", type: "hygiene" },
                        { id: 'p8_n5', text: "03:00 - Monitoreo respiraci√≥n", type: "check" },
                        { id: 'p8_n6', text: "06:00 - Signos vitales al despertar", type: "vital" }
                    ]
                }
            },
            {
                id: 'p9',
                name: "Don Antonio",
                condition: "EPOC Severo / O2 Dependiente",
                info: { address: "Calle Hidalgo #33", emergency: "Hijo: To√±o (445-222-3333)", age: "82", weight: "62kg", bloodType: "A+", allergies: "Polvo", doctor: "Dr. Neumo", diet: "Fraccionada" },
                tasks: {
                    dia: [
                        { id: 'p9_d1', text: "08:00 - Inhaladores (Bomba) y Oximetr√≠a", type: "med" },
                        { id: 'p9_d2', text: "09:00 - Desayuno (porciones peque√±as)", type: "food" },
                        { id: 'p9_d3', text: "10:30 - Nebulizaci√≥n con palmadopercusi√≥n", type: "med" },
                        { id: 'p9_d4', text: "12:00 - Ba√±o r√°pido (evitar fatiga)", type: "hygiene" },
                        { id: 'p9_d5', text: "14:00 - Comida y Chequeo tanque O2", type: "food" },
                        { id: 'p9_d6', text: "16:00 - Ejercicios respiratorios suaves", type: "physio" },
                        { id: 'p9_d7', text: "18:00 - Merienda y Oximetr√≠a en reposo", type: "vital" }
                    ],
                    noche: [
                        { id: 'p9_n1', text: "20:00 - Rellenar humidificador O2", type: "check" },
                        { id: 'p9_n2', text: "21:00 - Nebulizaci√≥n nocturna y Meds", type: "med" },
                        { id: 'p9_n3', text: "23:00 - Revisar bigotera nasal y orejas", type: "cure" },
                        { id: 'p9_n4', text: "02:00 - Oximetr√≠a sin despertar", type: "vital" },
                        { id: 'p9_n5', text: "04:00 - Chequeo flujo Ox√≠geno", type: "check" },
                        { id: 'p9_n6', text: "07:00 - Oximetr√≠a matutina y limpieza nasal", type: "vital" }
                    ]
                }
            },
            {
                id: 'p10',
                name: "Sra. Teresa",
                condition: "Demencia Senil / Riesgo Ca√≠das",
                info: { address: "Privada del Sol #5", emergency: "Hija: Maria (445-444-5555)", age: "88", weight: "48kg", bloodType: "O-", allergies: "Ninguna", doctor: "Dr. Geria", diet: "Alta cal√≥rica" },
                tasks: {
                    dia: [
                        { id: 'p10_d1', text: "08:30 - Despertar y cambio de pa√±al", type: "hygiene" },
                        { id: 'p10_d2', text: "09:30 - Desayuno completo asistido", type: "food" },
                        { id: 'p10_d3', text: "11:00 - Caminata vigilada (cintur√≥n seguridad)", type: "physio" },
                        { id: 'p10_d4', text: "12:30 - Hidrataci√≥n (Jalea/Agua)", type: "food" },
                        { id: 'p10_d5', text: "14:30 - Comida y Medicamentos", type: "food" },
                        { id: 'p10_d6', text: "16:30 - Aseo y cambio de ropa", type: "hygiene" },
                        { id: 'p10_d7', text: "18:00 - Juego de cartas/memoria", type: "physio" }
                    ],
                    noche: [
                        { id: 'p10_n1', text: "19:30 - Cena (cereal/leche)", type: "food" },
                        { id: 'p10_n2', text: "20:30 - Llevar al ba√±o y Pijama", type: "hygiene" },
                        { id: 'p10_n3', text: "21:30 - SUBIR BARANDALES CAMA", type: "check" },
                        { id: 'p10_n4', text: "00:00 - Revisi√≥n pa√±al (cambio si requiere)", type: "hygiene" },
                        { id: 'p10_n5', text: "03:00 - Ronda de seguridad (no despertar)", type: "check" },
                        { id: 'p10_n6', text: "06:00 - Cambio pa√±al matutino", type: "hygiene" }
                    ]
                }
            },
            {
                id: 'p11',
                name: "Don Miguel",
                condition: "Ceguera / Diabetes",
                info: { address: "Calle 5 de Mayo", emergency: "Esposa: Laura (445-666-7777)", age: "70", weight: "85kg", bloodType: "B+", allergies: "Mariscos", doctor: "Dr. Oftalmo", diet: "Diab√©tica" },
                tasks: {
                    dia: [
                        { id: 'p11_d1', text: "07:30 - Glucosa y Gu√≠a al ba√±o", type: "vital" },
                        { id: 'p11_d2', text: "08:00 - Insulina R√°pida y Desayuno (describir plato)", type: "food" },
                        { id: 'p11_d3', text: "10:00 - Rasurado y Ducha asistida", type: "hygiene" },
                        { id: 'p11_d4', text: "12:00 - Colaci√≥n y Medicaci√≥n oral", type: "med" },
                        { id: 'p11_d5', text: "14:00 - Comida (cuidar temperatura)", type: "food" },
                        { id: 'p11_d6', text: "16:00 - Radio/Audiolibro y Convivencia", type: "physio" },
                        { id: 'p11_d7', text: "18:00 - Caminata segura en patio", type: "physio" }
                    ],
                    noche: [
                        { id: 'p11_n1', text: "20:00 - Glucosa y Cena", type: "vital" },
                        { id: 'p11_n2', text: "21:00 - Aseo bucal y Pijama", type: "hygiene" },
                        { id: 'p11_n3', text: "22:00 - Verificar entorno seguro (sin obst√°culos)", type: "check" },
                        { id: 'p11_n4', text: "00:00 - Monitoreo sue√±o", type: "check" },
                        { id: 'p11_n5', text: "03:00 - Asistencia al ba√±o (Llamado)", type: "hygiene" },
                        { id: 'p11_n6', text: "06:00 - Preparar ropa d√≠a siguiente", type: "check" }
                    ]
                }
            },
            {
                id: 'p12',
                name: "Sra. Lupita",
                condition: "Postraci√≥n Total / √ölceras (Escaras)",
                info: { address: "Calle Obreg√≥n", emergency: "Hijo: Beto (445-000-1111)", age: "90", weight: "45kg", bloodType: "A-", allergies: "Adhesivo", doctor: "Dr. Heridas", diet: "Sonda NG" },
                tasks: {
                    dia: [
                        { id: 'p12_d1', text: "07:00 - Cambio pa√±al y S√°banas limpias", type: "hygiene" },
                        { id: 'p12_d2', text: "08:00 - ALIMENTACI√ìN SONDA (Bolus 1) + Meds", type: "food" },
                        { id: 'p12_d3', text: "09:00 - CURACI√ìN √öLCERAS (Sacro/Talones)", type: "cure" },
                        { id: 'p12_d4', text: "11:00 - MOVILIZACI√ìN (Reloj 11h) y Lubricar", type: "physio" },
                        { id: 'p12_d5', text: "13:00 - ALIMENTACI√ìN SONDA (Bolus 2) + Agua", type: "food" },
                        { id: 'p12_d6', text: "15:00 - MOVILIZACI√ìN (Reloj 15h) y Pa√±al", type: "physio" },
                        { id: 'p12_d7', text: "17:00 - Ba√±o de esponja en cama", type: "hygiene" },
                        { id: 'p12_d8', text: "18:00 - ALIMENTACI√ìN SONDA (Bolus 3)", type: "food" }
                    ],
                    noche: [
                        { id: 'p12_n1', text: "20:00 - Limpieza Sonda y Enjuague bucal", type: "hygiene" },
                        { id: 'p12_n2', text: "21:00 - MOVILIZACI√ìN (Dec√∫bito Lat Der)", type: "physio" },
                        { id: 'p12_n3', text: "23:00 - Cambio de Pa√±al estricto", type: "hygiene" },
                        { id: 'p12_n4', text: "00:00 - MOVILIZACI√ìN (Dec√∫bito Lat Izq)", type: "physio" },
                        { id: 'p12_n5', text: "03:00 - MOVILIZACI√ìN (Supino) y Pa√±al", type: "physio" },
                        { id: 'p12_n6', text: "06:00 - Aspiraci√≥n de secreciones (si requiere)", type: "cure" }
                    ]
                }
            }
        ];

        // ---------------------------------------------------------
        // 3. ICONOS
        // ---------------------------------------------------------
        const Icons = {
            Lock: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg>,
            MapPin: () => <svg className="w-4 h-4 mr-1 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path><circle cx="12" cy="10" r="3"></circle></svg>,
            Phone: () => <svg className="w-4 h-4 mr-1 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path></svg>,
            File: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>,
            LogOut: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path><polyline points="16 17 21 12 16 7"></polyline><line x1="21" y1="12" x2="9" y2="12"></line></svg>,
            Whatsapp: () => <svg className="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M.057 24l1.687-6.163c-1.041-1.804-1.588-3.849-1.587-5.946.003-6.556 5.338-11.891 11.893-11.891 3.181.001 6.167 1.24 8.413 3.488 2.245 2.248 3.481 5.236 3.48 8.414-.003 6.557-5.338 11.892-11.893 11.892-1.99-.001-3.951-.5-5.688-1.448l-6.305 1.654zm6.597-3.807c1.676.995 3.276 1.591 5.392 1.592 5.448 0 9.886-4.434 9.889-9.885.002-5.462-4.415-9.89-9.881-9.892-5.452 0-9.887 4.434-9.889 9.884-.001 2.225.651 3.891 1.746 5.634l-.999 3.648 3.742-.981zm11.387-5.464c-.074-.124-.272-.198-.57-.347-.297-.149-1.758-.868-2.031-.967-.272-.099-.47-.149-.669.149-.198.297-.768.967-.941 1.165-.173.198-.347.223-.644.074-.297-.149-1.255-.462-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.297-.347.446-.521.151-.172.2-.296.3-.495.099-.198.05-.372-.025-.521-.075-.148-.669-1.611-.916-2.206-.242-.579-.487-.501-.669-.51l-.57-.01c-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.463 1.065 2.876 1.213 3.074.149.198 2.095 3.2 5.076 4.487.709.306 1.263.489 1.694.626.712.226 1.36.194 1.872.118.571-.085 1.758-.719 2.006-1.413.248-.695.248-1.29.173-1.414z"/></svg>
        };

        // ---------------------------------------------------------
        // 4. COMPONENTES
        // ---------------------------------------------------------

        function LoginScreen({ onLogin }) {
            const [selectedUser, setSelectedUser] = React.useState("");
            const [pin, setPin] = React.useState("");
            const [error, setError] = React.useState("");

            const logoUrl = "https://raw.githubusercontent.com/jesusvn1993mplvt3-ai/MUVN-JMVN/main/LOGO%20MUVN.jpg";

            const handleAttempt = (e) => {
                e.preventDefault();
                const user = CAREGIVERS.find(c => c.name === selectedUser);
                if (user && user.pin === pin) {
                    onLogin(user);
                } else {
                    setError("PIN Incorrecto");
                    setPin("");
                }
            };

            return (
                <div className="flex flex-col items-center justify-center min-h-screen px-4 bg-gradient-to-br from-slate-900 to-slate-800">
                    <div className="bg-slate-800 p-8 rounded-2xl shadow-2xl w-full max-w-md text-center fade-in border border-slate-700">
                        
                        <div className="mx-auto w-32 h-32 rounded-full flex items-center justify-center mb-6 overflow-hidden bg-[#0E0E0E] p-1 border-4 border-muvnBlue">
                            <img src={logoUrl} alt="MUVN Logo" className="w-full h-full object-contain" />
                        </div>
                        
                        <h2 className="text-2xl font-bold text-white mb-1">Bienvenido a MUVN</h2>
                        <p className="text-sm text-slate-400 mb-6">Plataforma de Cuidados a Domicilio</p>

                        <form onSubmit={handleAttempt} className="space-y-5">
                            <div className="text-left">
                                <label className="block text-xs font-bold text-slate-400 uppercase mb-2">Seleccionar Personal</label>
                                <select 
                                    className="dark-input"
                                    value={selectedUser}
                                    onChange={(e) => {setSelectedUser(e.target.value); setError("");}}
                                >
                                    <option value="" className="text-gray-500">-- Elige tu nombre --</option>
                                    {CAREGIVERS.map(c => (
                                        <option key={c.pin} value={c.name} className="text-gray-900 font-medium">
                                            {c.name} {c.isSupervisor ? '(Supervisor)' : ''}
                                        </option>
                                    ))}
                                </select>
                            </div>

                            {selectedUser && (
                                <div className="text-left animate-fade-in">
                                    <label className="block text-xs font-bold text-slate-400 uppercase mb-2">Ingrese PIN (4 d√≠gitos)</label>
                                    <div className="relative">
                                        <div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none text-gray-500">
                                            <Icons.Lock />
                                        </div>
                                        <input 
                                            type="password" 
                                            maxLength="4"
                                            className="dark-input pl-10 text-center tracking-widest text-lg"
                                            value={pin}
                                            onChange={(e) => setPin(e.target.value)}
                                            placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                                        />
                                    </div>
                                    {error && <p className="text-red-400 text-xs mt-2 text-center font-bold">{error}</p>}
                                </div>
                            )}

                            <button 
                                disabled={!selectedUser || pin.length < 4}
                                className="w-full bg-[#0DA4BF] hover:bg-[#098a9f] text-white font-bold py-3 rounded-lg shadow-lg disabled:opacity-50 disabled:cursor-not-allowed transition-all mt-4"
                            >
                                Ingresar al Turno
                            </button>
                        </form>
                    </div>
                </div>
            );
        }

        function TechnicalSheet({ patient }) {
            const { info } = patient;
            return (
                <div className="bg-slate-800 rounded-xl shadow-sm border border-slate-700 overflow-hidden mb-6">
                    <div className="bg-[#0DA4BF] text-white px-4 py-3 flex items-center gap-2">
                        <Icons.File />
                        <h3 className="font-bold">Ficha T√©cnica del Paciente</h3>
                    </div>
                    <div className="p-5 space-y-4 text-sm">
                        
                        <div className="grid grid-cols-1 gap-2 pb-3 border-b border-slate-700">
                            <div>
                                <span className="block text-slate-400 text-xs uppercase">Paciente</span>
                                <span className="font-bold text-white text-xl">{patient.name}</span>
                            </div>
                             <div>
                                <span className="block text-slate-400 text-xs uppercase mt-2">Diagn√≥stico Principal</span>
                                <span className="font-semibold text-[#0DA4BF] text-md">{patient.condition}</span>
                            </div>
                        </div>

                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4 pb-3 border-b border-slate-700 bg-slate-800/50 p-3 rounded-lg">
                             <div className="col-span-2 md:col-span-1">
                                <span className="block text-slate-400 text-xs mb-1"><Icons.MapPin /> Direcci√≥n del Domicilio</span>
                                <span className="font-medium text-white break-words">{info.address}</span>
                            </div>
                            <div className="col-span-2 md:col-span-1 bg-red-900/20 p-2 rounded border border-red-900/50">
                                <span className="block text-red-300 text-xs font-bold mb-1"><Icons.Phone /> Contacto de Emergencia</span>
                                <span className="font-bold text-red-100 text-base">{info.emergency}</span>
                            </div>
                        </div>

                        <div className="grid grid-cols-2 gap-4 pt-2">
                             <div>
                                <span className="block text-slate-400 text-xs">Edad / Peso</span>
                                <span className="font-medium text-slate-200">{info.age} - {info.weight}</span>
                            </div>
                            <div>
                                <span className="block text-slate-400 text-xs">Tipo Sangre</span>
                                <span className="font-medium text-slate-200">{info.bloodType}</span>
                            </div>
                            <div>
                                <span className="block text-slate-400 text-xs text-red-300">Alergias</span>
                                <span className="font-medium text-red-200">{info.allergies}</span>
                            </div>
                             <div>
                                <span className="block text-slate-400 text-xs">M√©dico Tratante</span>
                                <span className="font-medium text-slate-200">{info.doctor}</span>
                            </div>
                             <div className="col-span-2 bg-slate-700 p-3 rounded border border-slate-600">
                                <span className="block text-yellow-400 text-xs font-bold mb-1">Dieta Indicada</span>
                                <span className="text-slate-200">{info.diet}</span>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        function SupervisorPatientList({ assignments, onSelectPatient, shift }) {
            return (
                 <div className="p-4 fade-in max-w-xl mx-auto mt-6">
                    <h2 className="text-2xl font-bold mb-6 text-white text-center">Lista de Pacientes Asignados</h2>
                    <h3 className="font-bold text-lg mb-4 flex items-center gap-2 text-white">
                        Turno {shift === 'dia' ? '‚òÄÔ∏è D√≠a (07:00 - 19:00)' : 'üåô Noche (19:00 - 07:00)'}
                    </h3>
                    
                    <div className="space-y-4">
                        {PATIENTS.map(p => {
                            const assignment = assignments[p.id] || { caregiver: 'Pendiente de Asignar', lastUpdate: null };
                            return (
                                <button 
                                    key={p.id} 
                                    onClick={() => onSelectPatient(p.id)}
                                    className="w-full text-left p-5 bg-slate-800 rounded-xl shadow-lg border border-slate-700 hover:border-[#0DA4BF] transition flex flex-col md:flex-row justify-between items-start md:items-center group"
                                >
                                    <div className="flex-1">
                                        <div className="font-bold text-lg text-white group-hover:text-[#0DA4BF] transition">{p.name}</div>
                                        <div className="text-xs text-slate-400 mt-1 mb-2">{p.condition}</div>
                                        <div className="text-sm text-slate-300 font-semibold mt-2">
                                            Asignado a: <span className="text-[#0DA4BF] font-bold">{assignment.caregiver}</span>
                                        </div>
                                        <div className="text-xs text-slate-500 mt-1">
                                            √öltimo registro: {assignment.lastUpdate || 'N/A'}
                                        </div>
                                    </div>
                                    <div className="text-slate-600 mt-3 md:mt-0 group-hover:text-[#0DA4BF] text-2xl">‚ûú</div>
                                </button>
                            );
                        })}
                    </div>
                </div>
            );
        }

        function Dashboard({ user, onLogout }) {
            const [selectedPatientId, setSelectedPatientId] = React.useState(null);
            
            // INICIALIZACI√ìN DEL TURNO BASADA EN CONFIGURACI√ìN HTML
            // Si tiene turno asignado, inicia con √©l. Si no, por defecto d√≠a.
            const [shift, setShift] = React.useState(user.assignedShift || "dia");
            
            const [records, setRecords] = React.useState({});
            const [generalObservation, setGeneralObservation] = React.useState("");
            const [status, setStatus] = React.useState("idle"); 
            const [assignments, setAssignments] = React.useState({}); 

            const isSupervisor = user.isSupervisor;
            const defaultPatient = user.assignedPatientId ? user.assignedPatientId : PATIENTS[0].id;

            // Determinar qu√© botones se pueden presionar
            // Supervisor puede todo. Usuario normal solo su turno asignado.
            const canSelectDay = isSupervisor || user.assignedShift === 'dia' || !user.assignedShift;
            const canSelectNight = isSupervisor || user.assignedShift === 'noche' || !user.assignedShift;

            const getTodayStr = () => new Date().toISOString().split('T')[0];
            const formatDate = (date) => date ? new Date(date.seconds * 1000).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit', hour12: true }) : 'N/A';

            React.useEffect(() => {
                if (!isSupervisor && !selectedPatientId) {
                    setSelectedPatientId(defaultPatient);
                }
            }, [isSupervisor, defaultPatient]);

            React.useEffect(() => {
                if(!selectedPatientId || isSupervisor) return;

                const loadData = async () => {
                    setStatus("loading");
                    const dateStr = getTodayStr();
                    const docId = `${dateStr}_${shift}_${selectedPatientId}`;
                    try {
                        const docRef = db.collection("registros_diarios").doc(docId);
                        const docSnap = await docRef.get();
                        if (docSnap.exists) {
                            const data = docSnap.data();
                            setRecords(data.records || {});
                            setGeneralObservation(data.generalObservation || "");
                        } else {
                            setRecords({}); setGeneralObservation("");
                        }
                    } catch (e) { console.error(e); } finally { setStatus("idle"); }
                };
                loadData();
            }, [selectedPatientId, shift, isSupervisor]);

            React.useEffect(() => {
                if (!isSupervisor) return;

                const fetchAssignments = async () => {
                    setStatus("loading_list");
                    const dateStr = getTodayStr();
                    try {
                        const snapshot = await db.collection("registros_diarios")
                            .where('date', '==', dateStr)
                            .get();
                        
                        const latestAssignments = {};

                        snapshot.docs.forEach(doc => {
                            const data = doc.data();
                            const { patientId, caregiver, lastUpdate } = data;
                            const updateTime = lastUpdate.toDate ? lastUpdate.toDate() : new Date(lastUpdate.seconds * 1000);

                            const key = patientId; 
                            if (!latestAssignments[key] || updateTime > latestAssignments[key].timestamp) {
                                latestAssignments[key] = {
                                    caregiver: caregiver,
                                    lastUpdate: updateTime.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit', hour12: true }),
                                    timestamp: updateTime
                                };
                            }
                        });

                        const patientAssignments = {};
                        PATIENTS.forEach(p => {
                             patientAssignments[p.id] = latestAssignments[p.id] || { caregiver: 'Pendiente de Registro', lastUpdate: null };
                        });
                        
                        setAssignments(patientAssignments);
                        setStatus("idle");
                    } catch (e) {
                        console.error("Error al cargar asignaciones:", e);
                        setStatus("error");
                    }
                };
                fetchAssignments();
            }, [isSupervisor, shift]);


            const saveData = async (newRecords, newObs) => {
                if(!selectedPatientId || isSupervisor) return;

                setStatus("saving");
                const dateStr = getTodayStr();
                const docId = `${dateStr}_${shift}_${selectedPatientId}`;
                try {
                    await db.collection("registros_diarios").doc(docId).set({
                        date: dateStr, shift: shift, patientId: selectedPatientId,
                        caregiver: user.name, 
                        lastUpdate: firebase.firestore.Timestamp.now(), records: newRecords, generalObservation: newObs
                    }, { merge: true });
                    setStatus("saved"); setTimeout(() => setStatus("idle"), 2000);
                } catch (e) { setStatus("error"); }
            };

            const toggleTask = (taskId) => {
                if(isSupervisor) return;
                const now = new Date();
                const timeString = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit', hour12: true });
                const current = records[taskId] || {};
                const updatedRec = current.checked 
                    ? { ...current, checked: false, completedAt: null }
                    : { ...current, checked: true, completedAt: timeString };
                const newRecords = { ...records, [taskId]: updatedRec };
                setRecords(newRecords);
                saveData(newRecords, generalObservation);
            };

            const handleNote = (taskId, note) => {
                 if(isSupervisor) return;
                const newRecords = { ...records, [taskId]: { ...(records[taskId] || {}), note: note } };
                setRecords(newRecords);
            };

            const handleSendWhatsapp = () => {
                 if(isSupervisor) return;
                const p = PATIENTS.find(pt => pt.id === selectedPatientId);
                const tasks = p.tasks[shift];
                let msg = `üè• *REPORTE MUVN - CUIDADOS EN CASA*\n`;
                msg += `üë§ ${user.name}\nüìÖ ${getTodayStr()} | Turno: ${shift.toUpperCase()}\n`;
                msg += `üë¥ Paciente: ${p.name}\nüìç Direcci√≥n: ${p.info.address}\n\n`;
                msg += `*ACTIVIDADES REALIZADAS:*\n`;
                tasks.forEach(t => {
                    const rec = records[t.id];
                    if(rec && rec.checked) {
                        msg += `‚úÖ ${t.text} @ ${rec.completedAt}\n`;
                        if(rec.note) msg += `   üìù Nota: ${rec.note}\n`;
                    } else {
                        msg += `‚≠ï ${t.text} (Pendiente)\n`;
                    }
                });
                if(generalObservation) msg += `\n*OBSERVACIONES GENERALES:*\n${generalObservation}\n`;
                window.open(`https://wa.me/524451586270?text=${encodeURIComponent(msg)}`, '_blank');
            };

            const currentPatient = PATIENTS.find(p => p.id === selectedPatientId);

            return (
                <div className="pb-24 bg-slate-900 min-h-screen">
                    <header className="bg-slate-800 sticky top-0 z-20 shadow-md border-b border-slate-700 px-4 py-3 flex justify-between items-center">
                        <div>
                            <h1 className="font-bold text-white flex items-center gap-2">
                                <span className="text-[#0DA4BF]">MUVN</span> {isSupervisor ? 'Supervisor' : 'App'}
                            </h1>
                             <p className="text-xs text-slate-400">{user.name}</p>
                        </div>
                        <div className="flex gap-2 items-center">
                             {status === 'saving' && <span className="text-xs text-yellow-400 animate-pulse">Guardando...</span>}
                             {status === 'saved' && <span className="text-xs text-green-400">‚úì Guardado</span>}
                            <button onClick={onLogout} className="p-2 bg-slate-700 rounded-full text-slate-300 hover:bg-slate-600 hover:text-white transition"><Icons.LogOut /></button>
                        </div>
                    </header>
                    
                    {(isSupervisor || !selectedPatientId) && (
                        <div className="p-4 fade-in max-w-xl mx-auto mt-6">
                            <label className="block text-sm font-semibold mb-3 text-slate-400">
                                {isSupervisor ? 'Selecciona Horario a Supervisar' : 'Tu Horario Asignado'}
                            </label>
                            
                            <div className="grid grid-cols-2 gap-4 mb-8">
                                <button 
                                    onClick={() => canSelectDay && setShift('dia')} 
                                    disabled={!canSelectDay}
                                    className={`p-4 rounded-xl border-2 font-bold transition flex flex-col items-center justify-center gap-2
                                        ${shift === 'dia' 
                                            ? 'border-[#0DA4BF] bg-[#0DA4BF]/20 text-white shadow-[0_0_15px_rgba(13,164,191,0.5)]' 
                                            : canSelectDay ? 'border-slate-700 bg-slate-800 text-slate-400 hover:border-slate-500' : 'border-slate-800 bg-slate-900 text-slate-700 opacity-40 cursor-not-allowed'
                                        }`}
                                >
                                    <span className="text-2xl">‚òÄÔ∏è</span>
                                    <span>D√≠a (12h)</span>
                                </button>
                                
                                <button 
                                    onClick={() => canSelectNight && setShift('noche')} 
                                    disabled={!canSelectNight}
                                    className={`p-4 rounded-xl border-2 font-bold transition flex flex-col items-center justify-center gap-2
                                        ${shift === 'noche' 
                                            ? 'border-indigo-400 bg-indigo-500/20 text-white shadow-[0_0_15px_rgba(129,140,248,0.5)]' 
                                            : canSelectNight ? 'border-slate-700 bg-slate-800 text-slate-400 hover:border-slate-500' : 'border-slate-800 bg-slate-900 text-slate-700 opacity-40 cursor-not-allowed'
                                        }`}
                                >
                                    <span className="text-2xl">üåô</span>
                                    <span>Noche (12h)</span>
                                </button>
                            </div>
                        </div>
                    )}

                    {isSupervisor && !selectedPatientId && (
                        status === 'loading_list' ? (
                            <div className="text-center p-8 text-lg text-[#0DA4BF]">Cargando asignaciones...</div>
                        ) : (
                            <SupervisorPatientList 
                                assignments={assignments} 
                                onSelectPatient={setSelectedPatientId}
                                shift={shift}
                            />
                        )
                    )}

                    {selectedPatientId && currentPatient && (
                        <div className="p-4 max-w-2xl mx-auto fade-in">
                            {(isSupervisor || (selectedPatientId !== defaultPatient)) && (
                                <button onClick={() => setSelectedPatientId(null)} className="text-sm text-[#0DA4BF] hover:text-white mb-4 flex items-center gap-1 transition">
                                    ‚Üê Volver a la lista
                                </button>
                            )}

                            <TechnicalSheet patient={currentPatient} />
                            
                            {isSupervisor && assignments[selectedPatientId] && (
                                <div className="bg-slate-700 p-4 rounded-xl border border-slate-600 mb-6">
                                    <span className="block text-xs font-bold uppercase text-slate-400">Cuidador Registrando el Turno Actual:</span>
                                    <span className="font-bold text-lg text-white">{assignments[selectedPatientId].caregiver}</span>
                                    <span className="text-xs text-slate-400 ml-2">(√öltimo registro: {assignments[selectedPatientId].lastUpdate})</span>
                                </div>
                            )}

                            <div className="mb-8">
                                <h3 className="font-bold text-lg mb-4 flex items-center gap-2 text-white">
                                    {shift === 'dia' ? '‚òÄÔ∏è Actividades Turno Matutino' : 'üåô Actividades Turno Nocturno'}
                                </h3>
                                <div className="space-y-3">
                                    {currentPatient.tasks[shift].map(task => {
                                        const rec = records[task.id] || {};
                                        return (
                                            <div key={task.id} className={`p-4 rounded-lg border transition-all ${rec.checked ? 'bg-slate-800/50 border-[#0DA4BF]/50' : 'bg-slate-800 border-slate-700 shadow-sm'}`}>
                                                <div className="flex items-start gap-4">
                                                    <div className="pt-1">
                                                        <input 
                                                            type="checkbox" 
                                                            checked={rec.checked || false} 
                                                            onChange={() => toggleTask(task.id)}
                                                            disabled={isSupervisor}
                                                            className={`w-6 h-6 accent-[#0DA4BF] cursor-pointer rounded focus:ring-offset-slate-800 focus:ring-[#0DA4BF] ${isSupervisor ? 'opacity-50 cursor-not-allowed' : ''}`}
                                                        />
                                                    </div>
                                                    <div className="flex-1">
                                                        <span className={`text-base font-medium ${rec.checked ? 'text-slate-500 line-through' : 'text-slate-100'}`}>
                                                            {task.text}
                                                        </span>
                                                        {rec.checked && <div className="text-xs text-[#0DA4BF] font-bold mt-1">Completado: {rec.completedAt}</div>}
                                                        
                                                        <input 
                                                            type="text" 
                                                            placeholder={isSupervisor ? "Solo lectura" : "Notas breves..."} 
                                                            className={`mt-3 w-full text-sm p-2 rounded text-slate-200 focus:outline-none focus:border-[#0DA4BF] transition ${isSupervisor ? 'bg-slate-900 border-slate-700/50 cursor-default' : 'bg-slate-900 border-slate-700'}`}
                                                            value={rec.note || ""}
                                                            onChange={(e) => handleNote(task.id, e.target.value)}
                                                            onBlur={() => saveData(records, generalObservation)}
                                                            disabled={isSupervisor}
                                                        />
                                                    </div>
                                                </div>
                                            </div>
                                        );
                                    })}
                                </div>
                            </div>

                            <div className="bg-slate-800 p-5 rounded-xl shadow-sm border border-slate-700 mb-20">
                                <h3 className="font-bold mb-3 text-sm uppercase text-slate-400">Bit√°cora del Turno / Eventualidades</h3>
                                <textarea 
                                    className={`w-full p-4 rounded-lg text-slate-200 text-sm focus:ring-2 focus:ring-[#0DA4BF] outline-none transition resize-none ${isSupervisor ? 'bg-slate-900 border-slate-700/50 cursor-default' : 'bg-slate-900 border-slate-700 focus:border-transparent'}`}
                                    rows="5"
                                    placeholder={isSupervisor ? "Solo lectura" : "Describe aqu√≠ c√≥mo transcurri√≥ el turno, estado de √°nimo del paciente, incidentes, etc..."}
                                    value={generalObservation}
                                    onChange={(e) => setGeneralObservation(e.target.value)}
                                    onBlur={() => saveData(records, generalObservation)}
                                    disabled={isSupervisor}
                                ></textarea>
                            </div>

                            {!isSupervisor && (
                                <div className="fixed bottom-0 left-0 w-full p-4 bg-slate-900/80 backdrop-blur-md border-t border-slate-800">
                                    <button 
                                        onClick={handleSendWhatsapp}
                                        className="w-full max-w-2xl mx-auto bg-[#0DA4BF] hover:bg-[#098a9f] text-white font-bold py-4 rounded-xl shadow-lg flex items-center justify-center gap-3 transition text-lg"
                                    >
                                        <Icons.Whatsapp /> Finalizar Turno y Enviar Reporte
                                    </button>
                                </div>
                            )}
                        </div>
                    )}
                </div>
            );
        }

        function App() {
            const [user, setUser] = React.useState(null);
            return (
                <div className="min-h-screen bg-slate-900 text-slate-100 relative">
                    {!user ? <LoginScreen onLogin={setUser} /> : <Dashboard user={user} onLogout={() => setUser(null)} />}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
